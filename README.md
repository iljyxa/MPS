# Микропроцессорные системы (ЗО)

## 1. Описание принстонской и гарвардской архитектур микропроцессорных систем. Основные факторы, влияющие на производительность и быстродействие микропроцессорных систем. Основные характеристики CISC и RISC микропроцессоров. Особенности ARM архитектуры.

### Принстонская и Гарвардская архитектуры микропроцессорных систем

#### Принстонская (или фон Неймана) архитектура

**Принстонская архитектура**, также известная как архитектура фон Неймана, названа в честь Джона фон Неймана, предложившего эту концепцию. Основные характеристики этой архитектуры:

1. **Единое адресное пространство**: Память для хранения данных и инструкций является общей.
2. **Последовательное выполнение**: Процессор выполняет одну инструкцию за раз, извлекая ее из памяти.
3. **Бутылочные горлышки**: Так как данные и инструкции передаются по одной и той же шине, это может стать узким местом (т.н. "фон Неймановское узкое место").

Примеры: большинство традиционных компьютеров, использующих данную архитектуру.

#### Гарвардская архитектура

**Гарвардская архитектура** отличается раздельными хранилищами для инструкций и данных. Основные черты:

1. **Раздельные адресные пространства**: Память для инструкций и данных разделена.
2. **Параллельное выполнение**: Возможность одновременного извлечения данных и инструкций, что улучшает производительность.
3. **Более сложный дизайн**: Увеличенная сложность схем, но повышенная эффективность.

Примеры: микроконтроллеры и сигнальные процессоры.

### Основные факторы, влияющие на производительность микропроцессорных систем

1. **Тактовая частота**: Скорость, с которой процессор выполняет инструкции, измеряемая в герцах (Гц).
2. **Архитектура**: Влияние различных архитектурных решений, таких как количество ядер, глубина конвейера, архитектурные оптимизации.
3. **Ширина шины данных**: Ширина шины определяет количество данных, которые могут передаваться за один такт.
4. **Кэш-память**: Объем и уровень кэш-памяти, которые уменьшают время доступа к часто используемым данным.
5. **Параллелизм**: Способность выполнения множества операций одновременно, что достигается многопоточностью и многозадачностью.
6. **Оптимизация программного обеспечения**: Как хорошо программное обеспечение использует возможности аппаратного обеспечения.

### Основные характеристики CISC и RISC микропроцессоров

#### CISC (Complex Instruction Set Computer)

1. **Большой набор инструкций**: Включает множество специализированных инструкций.
2. **Многоступенчатое выполнение**: Некоторые инструкции выполняются в несколько этапов, что увеличивает сложность и время выполнения.
3. **Меньше регистров**: Ограниченное количество регистров для уменьшения сложности компилятора.
4. **Пример**: Intel x86.

#### RISC (Reduced Instruction Set Computer)

1. **Малый набор инструкций**: Набор простых и быстрых инструкций.
2. **Одноступенчатое выполнение**: Большинство инструкций выполняется за один такт процессора.
3. **Больше регистров**: Увеличенное количество регистров для уменьшения обращений к памяти.
4. **Пример**: ARM, MIPS.

### Особенности ARM архитектуры

1. **Энергоэффективность**: ARM процессоры известны своей низкой потребляемой мощностью, что делает их идеальными для мобильных устройств и встраиваемых систем.
2. **Скалируемость**: ARM архитектура используется в различных устройствах - от маломощных микроконтроллеров до высокопроизводительных серверов.
3. **RISC-принципы**: Использует RISC-принципы с упрощенным набором команд, что способствует быстрому выполнению и простоте реализации.
4. **Лицензирование**: ARM не производит процессоры, а лицензирует свою архитектуру другим компаниям, что позволяет широкому спектру производственных решений.
5. **Поддержка расширений**: Включает множество расширений, таких как NEON для обработки мультимедиа и SIMD операций, TrustZone для безопасности и др.

ARM процессоры применяются в широком спектре устройств, включая смартфоны, планшеты, носимые устройства и даже серверы.

## 2. Базовая архитектура 8-битных AVR микроконтроллеров, описание основных узлов и их функции.

### Базовая архитектура 8-битных AVR микроконтроллеров

8-битные AVR микроконтроллеры, разработанные компанией Atmel (ныне часть Microchip Technology), являются популярными устройствами в мире встроенных систем благодаря своей простоте, эффективности и мощному набору функций. Рассмотрим основные узлы архитектуры AVR и их функции.

#### Основные узлы архитектуры AVR микроконтроллеров

1. **Арифметико-логическое устройство (АЛУ)**:
   - Выполняет арифметические и логические операции.
   - Работает за один такт, что обеспечивает высокую производительность.
   - Поддерживает такие операции, как сложение, вычитание, логическое И, ИЛИ, исключающее ИЛИ и побитовые сдвиги.

2. **Регистровый файл**:
   - Состоит из 32 8-битных регистров общего назначения (R0-R31).
   - Регистры используются для хранения временных данных и промежуточных результатов операций.
   - Три из этих регистров (R26-R31) могут быть объединены в указатели X, Y и Z для косвенной адресации.

3. **Память программ (Flash)**:
   - Хранит программный код.
   - Электрически перепрограммируемая память позволяет изменять содержимое программной памяти без удаления микроконтроллера с печатной платы.

4. **Память данных (SRAM)**:
   - Используется для хранения данных и временных переменных во время выполнения программы.
   - Быстрый доступ к данным благодаря высокой скорости работы SRAM.

5. **Энергонезависимая память данных (EEPROM)**:
   - Предназначена для хранения постоянных данных, которые сохраняются даже после выключения питания.
   - Используется для хранения настроек и конфигураций, которые могут быть изменены пользователем.

6. **Счетчик команд (PC)**:
   - Указывает на текущую исполняемую инструкцию в памяти программ.
   - Автоматически увеличивается для перехода к следующей инструкции или изменяется при выполнении инструкций перехода.

7. **Интерфейсы ввода-вывода (I/O Ports)**:
   - Позволяют микроконтроллеру взаимодействовать с внешними устройствами.
   - Обычно реализованы в виде нескольких портов, каждый из которых может быть настроен на ввод или вывод данных.

8. **Прерывания**:
   - Механизм, позволяющий микроконтроллеру реагировать на внешние или внутренние события немедленно, прерывая основное выполнение программы.
   - Поддержка различных типов прерываний, таких как внешние прерывания, таймеры, UART, SPI и другие.

9. **Таймеры/Счетчики**:
   - Используются для измерения времени, создания временных задержек, генерации сигналов PWM (широтно-импульсная модуляция) и других задач, связанных с временными интервалами.
   - Обычно включают несколько таймеров, работающих с разной разрядностью (8-битные и 16-битные).

10. **Аналого-цифровой преобразователь (ADC)**:
    - Преобразует аналоговые сигналы в цифровые значения для обработки микроконтроллером.
    - Поддерживает многоканальные входы для одновременного измерения нескольких аналоговых сигналов.

11. **Система тактирования**:
    - Определяет скорость работы микроконтроллера.
    - Может быть реализована с использованием внешнего кварцевого резонатора или внутреннего RC-осциллятора.

### Описание функций основных узлов

- **АЛУ**: Выполняет основные арифметические и логические операции, являясь ключевым компонентом для обработки данных.
- **Регистровый файл**: Обеспечивает высокую скорость выполнения операций благодаря наличию 32 регистров общего назначения.
- **Память программ (Flash)**: Хранит программный код, обеспечивает долговременное хранение и перепрограммируемость.
- **Память данных (SRAM)**: Обеспечивает быстрое хранение и доступ к временным данным.
- **EEPROM**: Обеспечивает хранение данных, сохраняющихся при выключении питания, таких как настройки и конфигурации.
- **Счетчик команд (PC)**: Управляет последовательностью выполнения программных инструкций.
- **Интерфейсы ввода-вывода (I/O Ports)**: Позволяют взаимодействовать с внешними устройствами, такими как датчики и исполнительные механизмы.
- **Прерывания**: Обеспечивают немедленную реакцию на события, улучшая производительность и отклик системы.
- **Таймеры/Счетчики**: Обеспечивают управление временными интервалами, измерение времени и генерацию сигналов.
- **Аналого-цифровой преобразователь (ADC)**: Позволяет микроконтроллеру обрабатывать аналоговые сигналы.
- **Система тактирования**: Определяет скорость выполнения операций микроконтроллером, влияя на общую производительность системы.

Эти узлы и функции делают 8-битные AVR микроконтроллеры мощным инструментом для широкого спектра приложений в встроенных системах.

## 2) Регистры общего назначения, структура, место в системном адресном пространстве, способы и иерархия доступа, регистровые пары. Опишите особенности и назначение счетчика команд, регистра адреса и регистра команд. Регистр состояний. Приведите пример использования регистра состояний. Опишите структуру программы на языке ассемблер. Логические команды. Сдвиг. Команды пересылки данных. Команды ввода/вывода. Условный и безусловный переход. Вызов подпрограмм. Команды прерываний. Приведите примеры использования обозначенных команд.

### Регистры общего назначения

#### Структура и место в системном адресном пространстве

8-битные AVR микроконтроллеры имеют 32 8-битных регистра общего назначения (R0 - R31), которые являются частью регистрового файла. Эти регистры расположены в самом начале системного адресного пространства и имеют следующие особенности:

1. **Быстрый доступ**: Регистры расположены в регистровом файле и имеют очень быстрое время доступа.
2. **Нумерация регистров**: Они пронумерованы от R0 до R31.

#### Способы и иерархия доступа

1. **Прямой доступ**: Операции могут непосредственно обращаться к любому из регистров.
2. **Косвенная адресация**: Регистры R26-R31 могут использоваться как указатели (X, Y, Z) для косвенного доступа к данным в памяти.
   - **X-регистр**: Состоит из R26 (нижний байт) и R27 (верхний байт).
   - **Y-регистр**: Состоит из R28 (нижний байт) и R29 (верхний байт).
   - **Z-регистр**: Состоит из R30 (нижний байт) и R31 (верхний байт).

### Счетчик команд (PC)

#### Особенности и назначение

1. **Счетчик команд (Program Counter, PC)**: Указывает на текущую исполняемую инструкцию в памяти программ.
2. **Инкрементирование**: Автоматически увеличивается на единицу после каждой выполненной инструкции, что позволяет перейти к следующей команде.
3. **Изменение значения**: Может изменяться при выполнении команд перехода, вызова подпрограмм и при прерываниях.

### Регистр адреса и регистр команд

#### Регистр адреса

1. **Регистр адреса (Address Register)**: Используется для хранения адреса памяти, к которому обращается микроконтроллер.
2. **Косвенная адресация**: Обычно используются регистры X, Y и Z для косвенной адресации памяти данных.

#### Регистр команд

1. **Регистр команд (Instruction Register, IR)**: Хранит текущую инструкцию, извлеченную из памяти программ, для её декодирования и выполнения.

### Регистр состояний

#### Назначение

1. **Регистр состояний (Status Register, SREG)**: Содержит флаги состояния, которые отражают результат выполнения последних операций.
2. **Основные флаги**:
   - **Carry (C)**: Флаг переноса/заема.
   - **Zero (Z)**: Флаг нуля.
   - **Negative (N)**: Флаг отрицательного результата.
   - **Overflow (V)**: Флаг переполнения.
   - **Sign (S)**: Флаг знака (N XOR V).
   - **Half Carry (H)**: Флаг полупереноса.
   - **Interrupt (I)**: Флаг глобального разрешения прерываний.

#### Пример использования регистра состояний

```assembly
ADD R1, R2  ; Сложение R1 и R2, результат в R1
BRNE LABEL  ; Переход к LABEL, если флаг Z (Zero) сброшен (результат не равен нулю)
```

### Структура программы на языке ассемблер

Программа на языке ассемблер состоит из следующих частей:
1. **Секции данных**: Объявление констант и переменных.
2. **Секции кода**: Основной код программы, включающий команды и метки.

Пример программы:

```assembly
.CSEG
.ORG 0x0000
RJMP START

.ORG 0x0050
START:
    LDI R16, 0x01    ; Загрузить значение 0x01 в регистр R16
    OUT PORTB, R16   ; Вывести значение R16 на порт B
    NOP              ; Нет операции (задержка)
    RJMP START       ; Бесконечный цикл
```

### Логические команды

Примеры:

1. **AND**: Логическое И.
   ```assembly
   AND R1, R2  ; R1 = R1 AND R2
   ```
2. **OR**: Логическое ИЛИ.
   ```assembly
   OR R1, R2  ; R1 = R1 OR R2
   ```
3. **EOR**: Логическое исключающее ИЛИ.
   ```assembly
   EOR R1, R2  ; R1 = R1 XOR R2
   ```

### Команды сдвига

Примеры:

1. **LSL**: Логический сдвиг влево.
   ```assembly
   LSL R1  ; Сдвиг влево содержимого R1
   ```
2. **LSR**: Логический сдвиг вправо.
   ```assembly
   LSR R1  ; Сдвиг вправо содержимого R1
   ```

### Команды пересылки данных

Примеры:

1. **LDI**: Загрузка немедленного значения в регистр.
   ```assembly
   LDI R16, 0xFF  ; Загрузка 0xFF в R16
   ```
2. **MOV**: Копирование данных из одного регистра в другой.
   ```assembly
   MOV R1, R2  ; Копирование содержимого R2 в R1
   ```

### Команды ввода/вывода

Примеры:

1. **IN**: Ввод данных из порта.
   ```assembly
   IN R1, PIND  ; Ввод данных из порта D в R1
   ```
2. **OUT**: Вывод данных на порт.
   ```assembly
   OUT PORTB, R1  ; Вывод данных из R1 на порт B
   ```

### Условный и безусловный переход

Примеры:

1. **RJMP**: Безусловный относительный переход.
   ```assembly
   RJMP LABEL  ; Переход к метке LABEL
   ```
2. **BREQ**: Условный переход, если флаг Z установлен.
   ```assembly
   BREQ LABEL  ; Переход к метке LABEL, если результат последней операции был нулевым
   ```

### Вызов подпрограмм

Пример:

1. **RCALL**: Вызов подпрограммы.
   ```assembly
   RCALL SUBROUTINE  ; Вызов подпрограммы SUBROUTINE
   ```

### Команды прерываний

Примеры:

1. **SEI**: Установка флага глобального разрешения прерываний.
   ```assembly
   SEI  ; Разрешение прерываний
   ```
2. **CLI**: Сброс флага глобального разрешения прерываний.
   ```assembly
   CLI  ; Запрещение прерываний
   ```
3. **RETI**: Возврат из подпрограммы обработки прерывания.
   ```assembly
   RETI  ; Возврат из обработчика прерывания
   ```

### Примеры использования обозначенных команд

Пример программы с использованием различных команд:

```assembly
.CSEG
.ORG 0x0000
RJMP MAIN

.ORG 0x0050
MAIN:
    LDI R16, 0x01        ; Загрузка 0x01 в R16
    OUT DDRB, R16       ; Настройка порта B как выходного
    SEI                 ; Разрешение прерываний
LOOP:
    LDI R18, 0x00       ; Загрузка 0x00 в R18
    OUT PORTB, R18      ; Выключение всех светодиодов на порту B
    CALL DELAY          ; Вызов подпрограммы задержки
    LDI R18, 0xFF       ; Загрузка 0xFF в R18
    OUT PORTB, R18      ; Включение всех светодиодов на порту B
    CALL DELAY          ; Вызов подпрограммы задержки
    RJMP LOOP           ; Бесконечный цикл

DELAY:
    LDI R19, 0xFF       ; Загрузка значения 0xFF в R19
DELAY_LOOP:
    DEC R19             ; Уменьшение R19 на 1
    BRNE DELAY_LOOP     ; Переход к DELAY_LOOP, если R19 не равно 0
    RET                 ; Возврат из подпрограммы
```

Этот пример иллюстрирует использование различных команд для выполнения простых задач, таких как настройка порта ввода/вывода, разрешение прерываний, выполнение логических операций и создание задержек.

## 3) Система команд AVR микроконтроллеров, операции ветвления, условные и безусловные переходы, операции работы с битами, директивы препроцессора. Перечислите способы адресации в микропроцессорных устройствах и системах. Поясните различия косвенной и прямой адресации. Опишите схему базовой адресации. Опишите функционирование стековой адресации. Обобщенная структура команд. Безадресные команды. Многоадресные. Командный цикл.

### Система команд AVR микроконтроллеров

AVR микроконтроллеры имеют богатую систему команд, позволяющую выполнять широкий спектр операций. Рассмотрим основные категории команд и их особенности.

#### Операции ветвления

**Условные и безусловные переходы**

1. **Безусловные переходы**:
   - **RJMP**: Относительный переход.
     ```assembly
     RJMP LABEL  ; Переход к метке LABEL
     ```
   - **IJMP**: Косвенный переход.
     ```assembly
     IJMP  ; Переход к адресу, хранящемуся в Z-регистре
     ```
   - **JMP**: Прямой переход.
     ```assembly
     JMP 0x1234  ; Переход к адресу 0x1234
     ```

2. **Условные переходы**:
   - **BREQ**: Переход, если результат последней операции был нулевым (флаг Z установлен).
     ```assembly
     BREQ LABEL  ; Переход к метке LABEL, если Z = 1
     ```
   - **BRNE**: Переход, если результат последней операции не был нулевым (флаг Z сброшен).
     ```assembly
     BRNE LABEL  ; Переход к метке LABEL, если Z = 0
     ```
   - **BRCS**: Переход, если установлен флаг переноса (Carry).
     ```assembly
     BRCS LABEL  ; Переход к метке LABEL, если C = 1
     ```

#### Операции работы с битами

1. **SBI**: Установить бит в регистре ввода-вывода.
   ```assembly
   SBI PORTB, 3  ; Установить 3-й бит в порте B
   ```
2. **CBI**: Сбросить бит в регистре ввода-вывода.
   ```assembly
   CBI PORTB, 3  ; Сбросить 3-й бит в порте B
   ```
3. **BST**: Сохранить бит в регистре в T-флаг регистра состояний.
   ```assembly
   BST R16, 2  ; Сохранить 2-й бит из R16 в T-флаг
   ```

### Директивы препроцессора

Директивы препроцессора используются для управления компиляцией и сборкой программ. Некоторые основные директивы:

1. **.ORG**: Указывает начальный адрес секции кода или данных.
   ```assembly
   .ORG 0x0100  ; Начало секции кода с адреса 0x0100
   ```
2. **.DB**: Определяет байт данных.
   ```assembly
   .DB 0x55  ; Определение байта данных 0x55
   ```
3. **.EQU**: Определяет константу.
   ```assembly
   CONSTANT .EQU 0x20  ; Определение константы с значением 0x20
   ```

### Способы адресации в микропроцессорных устройствах

1. **Прямая адресация**: Операнд указывается непосредственно в команде.
2. **Косвенная адресация**: Адрес операнда хранится в регистре.
3. **Непрямая адресация с базой и смещением**: Адрес операнда вычисляется как сумма базового адреса и смещения.
4. **Непосредственная адресация**: Операнд задан непосредственно в команде.
5. **Регистр-регистрная адресация**: Операнд хранится в регистре.
6. **Непосредственная регистровая адресация**: Операнд указывается непосредственно, но операцией является регистр.

### Различия между косвенной и прямой адресацией

1. **Прямая адресация**:
   - Операнд указывается непосредственно в команде.
   - Быстрое извлечение данных.
   - Пример: `LD R0, 0x1234` - загрузка значения из памяти по адресу 0x1234 в регистр R0.

2. **Косвенная адресация**:
   - Адрес операнда хранится в регистре.
   - Гибкость в работе с массивами и указателями.
   - Пример: `LD R0, X` - загрузка значения из памяти по адресу, хранящемуся в X-регистре, в регистр R0.

### Схема базовой адресации

В базовой адресации используется регистр в качестве указателя на адрес, а смещение добавляется к этому адресу.

```assembly
LD R0, Y+10  ; Загрузка значения из памяти по адресу Y + 10 в R0
```

### Функционирование стековой адресации

Стековая адресация использует специальный регистр стека (SP) для управления стеком.

1. **PUSH**: Сохранение данных в стек.
   ```assembly
   PUSH R16  ; Сохранение значения R16 в стек
   ```
2. **POP**: Извлечение данных из стека.
   ```assembly
   POP R16  ; Извлечение значения из стека в R16
   ```

### Обобщенная структура команд

Команды могут быть одноадресными, двухадресными или многоадресными, в зависимости от количества операндов.

1. **Безадресные команды**: Не имеют операндов.
   ```assembly
   NOP  ; Нет операции
   ```
2. **Одноадресные команды**: Имеют один операнд.
   ```assembly
   INC R0  ; Увеличение значения в регистре R0 на 1
   ```
3. **Двухадресные команды**: Имеют два операнда.
   ```assembly
   MOV R0, R1  ; Копирование значения из R1 в R0
   ```

### Командный цикл

Командный цикл состоит из нескольких этапов:

1. **Fetch**: Извлечение команды из памяти программ.
2. **Decode**: Декодирование команды.
3. **Execute**: Выполнение команды.
4. **Write back**: Запись результата выполнения (если требуется).

### Примеры использования обозначенных команд

1. **Безусловный переход**:
   ```assembly
   RJMP START  ; Переход к метке START
   ```

2. **Условный переход**:
   ```assembly
   CP R16, R17
   BREQ EQUAL  ; Переход к метке EQUAL, если R16 = R17
   ```

3. **Работа с битами**:
   ```assembly
   SBI PORTB, 0  ; Установить 0-й бит порта B
   CBI PORTB, 0  ; Сбросить 0-й бит порта B
   ```

4. **Директивы препроцессора**:
   ```assembly
   .ORG 0x0100
   .DB 0x55
   CONSTANT .EQU 0x20
   ```

5. **Адресация**:
   ```assembly
   LDI R16, 0x10  ; Непосредственная адресация
   LD R0, X       ; Косвенная адресация
   ```

6. **Стековая адресация**:
   ```assembly
   PUSH R16
   POP R16
   ```

Эти примеры демонстрируют, как команды могут быть использованы для выполнения различных операций в программировании AVR микроконтроллеров.

## 4) Организация памяти в AVR 8-битных микроконтроллерах. Резервирование памяти в ОЗУ, способ доступа к ОЗУ, инициализация и работа со с стеком.

## 5) Основные отличия EEPROM от FLASH памяти. Алгоритм чтения/записи данных EEPROM.

## 6) Порты ввода/вывода. Внутреннее устройство порта и его регистры. Способы устранения и подавления дребезга контактов.

## 7) Поясните понятие прерывания. Контролер прерываний. Процесс прерывания основный программы и переход в обработчик прерывания. Описание таблиц и вектора прерываний. Описание внешних прерываний. Приведите пример использования прерываний. Аппаратные и программные прерывания.

## 8) Таймеры - счетчики в составе системы - на - кристалле на примере Atmel AVR. Назначение и функциональный состав 8-ми разрядного таймера счетчика. Режимы функционирования, ШИМ - режим таймера. Тактирование таймера от встроенного генератора и тактирование внешним сигналом. Приведите пример функциональной схемы при использования таймера - счетчика для организации тахометра. Приведите пример расчета параметров таймера для организации требуемого интервала срабатывания. Опишите функционирование таймера в режиме часов реального времени. Опишите принцип функционирования сторожевого таймера.

## 9) Аналого-цифровой преобразователь. Тип и основные характеристик АЦП семейства 8-битных AVR микроконтроллеров. Режимы работы АЦП, источники синхронизации в циклическом режиме. Модули аналогового ввода/вывода в составе системы - на - кристалле на примере Atmel AVR. Параллельные АЦП, их параметры, достоинства и недостатки. Особенности сопряжения параллельных АЦП с микропроцессорными системами. АЦП последовательных приближений, их типичные характеристики достоинства и недостатки. Особенности подключения последовательных АЦП в микропроцессорных системах, программная реализация АЦП последовательного типа.

## 10) Символьный ЖКИ с контролером HP 44780. Описание интерфейса контроллера HP 44780. Разрядность шины данных. Режимы работы ЖКИ. 

## 11)  Описание шинной структуры связей в микропроцессорных системах. Описание шин микропроцессорной системы и организация циклов обмена информацией. Описание программного обмена информацией и обмена информацией по прерываниям. Описание обмена данными в режиме прямого доступа к памяти.

## 12) Методы и средства совместной отладки аппаратных и программных средств. Функциональные возможности внутрисхемных эмуляторов. Достоинства и недостатки внутрисхемных эмуляторов. Виды программных симуляторов. Особенности отладки МПС на различных этапах жизненного цикла.

## 13) Контроллер последовательной синхронной передачи. Описание структурной схемы контроллера синхронной передачи. Аппаратные средства канала последовательной связи. Стандартные интерфейсы последовательного обмена.
